extends home
block issues
	.gridbox.gridmain
		ul(id="issues")
			li.postIssuePart
				form(method='POST', id="postIssueForm", action="/post")		
					.issuePart1D(style="display:inline-block;width:100%;padding-left:13px")
						div(style="float:left")
							h(style="font-weight:500;font-size:14pt") Add issue
						div(style="float:right")
							i(class="glyphicon glyphicon-plus" id="expandPost")						
					
					.main.issueBlock
						#nextBtn(style="display:none;transition: all .1s ease-in;")
							div(style="margin-left:5px")
									.custom-select(style='width:100%;')
										select(name="orguserId")
											option Select organisation
											for ech in adminctrlorgs
												option(value=ech.userId) #{ech.name}
											for ech in memberctrlorgs
												option(value=ech.userId) #{ech.name}

									
									input(type='text' id="issueDescriptionTopic" name="issueDescriptionTopic" placeholder="Issue Topic..." required)
									
									textarea(id="issueDescriptionText" name="issueDescriptionText" placeholder="Write detailed description" required )
									
									div(style="display:inline-block;width:100%")
										div(style="display:inline-flex;float:left")
											input(type="checkbox" id="anonymity" name="anonymity")
											span(style="color:black;width:150px") Be Anonymous
										div(style="text-align:center;float:right")
											input( value="Post" type="submit" name="issuePost" id="issuePost")
						
			if issues
				for each in issues	
					li.issuePart
						.issuePart1D(style="display:inline-block;width:100%;padding-left:13px")
							div(style="float:left;")
								if (each.anonymity==="on")
									span(style='font-weight:900') Anonymous
								else if(each.anonymity==="off")
									a(href="/profile/"+each.username id="linkProfile" style='font-weight:900;') #{each.name}
								
								span(style='color:gray')  
									i.glyphicon.glyphicon-play(style="font-size:10pt")  
									a(href="/orgs/"+each.orgUserId id="linkProfile" style='font-weight:900;')  #{each.orgname}
								p(id="date") #{each.datePosted}

							div(style="float:right")
								if trending
									i.glyphicon.glyphicon-fire(style="color:red;margin:5px" aria-hidden='true')
									
								if (each.status==="open")
									i(class="mega-octicon octicon-issue-opened" )
										span  Open
								else
									i(class="mega-octicon octicon-issue-closed")
										span  Closed
							
						.main.issueBlock
							#nextBtn
								div(style="margin-left:10px")
									a#issueTopic(href="/indpost/"+each._id) #{each.issueTopic}
								#issueDesc #{each.issueDesc}
						
						.issueCommentPart
							button(id="likeBtn")
								if (each.supporters.indexOf(username))
									i(class="fa fa-thumbs-o-up" style="font-size:18px")
									|  Like
								else
									i(class="fa fa-thumbs-up" style="font-size:18px")
									|  Like

							button(id="commentBtn")
								i(class="mega-octicon octicon-comment" style="font-size:18px")
								|  Comment
	
	script.
		//- ////////////////////////// Coded from W3schools for options /////////////////////////////////////////////////
		var x, i, j, selElmnt, a, b, c;
			/*look for any elements with the class "custom-select":*/
			x = document.getElementsByClassName("custom-select");
			for (i = 0; i < x.length; i++) {
			  selElmnt = x[i].getElementsByTagName("select")[0];
			  /*for each element, create a new DIV that will act as the selected item:*/
			  a = document.createElement("DIV");
			  a.setAttribute("class", "select-selected");
			  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
			  x[i].appendChild(a);
			  /*for each element, create a new DIV that will contain the option list:*/
			  b = document.createElement("DIV");
			  b.setAttribute("class", "select-items select-hide");
			  for (j = 1; j < selElmnt.length; j++) {
			    /*for each option in the original select element,
			    create a new DIV that will act as an option item:*/
			    c = document.createElement("DIV");
			    c.innerHTML = selElmnt.options[j].innerHTML;
			    c.addEventListener("click", function(e) {
			        /*when an item is clicked, update the original select box,
			        and the selected item:*/
			        var i, s, h;
			        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
			        h = this.parentNode.previousSibling;
			        for (i = 0; i < s.length; i++) {
			          if (s.options[i].innerHTML == this.innerHTML) {
			            s.selectedIndex = i;
			            h.innerHTML = this.innerHTML;
			            break;
			          }
			        }
			        h.click();
			    });
			    b.appendChild(c);
			  }
			  x[i].appendChild(b);
			  a.addEventListener("click", function(e) {
			      /*when the select box is clicked, close any other select boxes,
			      and open/close the current select box:*/
			      e.stopPropagation();
			      closeAllSelect(this);
			      this.nextSibling.classList.toggle("select-hide");
			      this.classList.toggle("select-arrow-active");
			  });
			}
			function closeAllSelect(elmnt) {
			  /*a function that will close all select boxes in the document,
			  except the current select box:*/
			  var x, y, i, arrNo = [];
			  x = document.getElementsByClassName("select-items");
			  y = document.getElementsByClassName("select-selected");
			  for (i = 0; i < y.length; i++) {
			    if (elmnt == y[i]) {
			      arrNo.push(i)
			    } else {
			      y[i].classList.remove("select-arrow-active");
			    }
			  }
			  for (i = 0; i < x.length; i++) {
			    if (arrNo.indexOf(i)) {
			      x[i].classList.add("select-hide");
			    }
			  }
			}
			/*if the user clicks anywhere outside the select box,
			then close all select boxes:*/
			document.addEventListener("click", closeAllSelect);

			//- //////////////////////////////////////////////////////////////////////////////////////////

			$('#expandPost').click(function(){
				$('#nextBtn').toggle();
				$(this).toggleClass('glyphicon-plus glyphicon-minus');
			})

			$('button#likeBtn').click(function(e){
			    e.preventDefault();
			    $(this).find('i.fa').toggleClass('fa-thumbs-o-up fa-thumbs-up');
			    var id = $(this).parents('li.issuePart').find('a#issueTopic').attr('href');
			    console.log(id);
			    
			    id = id.substring(9);
			    console.log(id);
			    
			    var _url = "/likepost/"+id;
			    console.log(_url);
			    $.post({
				  url: _url,
				});
			});