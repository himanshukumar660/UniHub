extends org
block issues
  .gridbox.gridmain
    ul(id="issues")
      
      li.postIssuePart(style="border-radius:3px")
        .issuePart1D(style="background-color:white;display:inline-flex;text-align:center;width:100%;padding-left:13px;border-radius:3px")
          div(style="width:100%;" id="openBtn")
            i(class="mega-octicon octicon-issue-opened" style="background-color:unset!important;color:black;font-size:14pt;")
            | #{orgDtl.pendingRequest.length}
            | Pending Requests         

      if(search(username, orgDtl.admin))    
        if (orgDtl.pendingRequest.length>0)
          for each in orgDtl.pendingRequest  
            li.issuePart(style="background-color:unset;border:none")
              .issuePart1D(style="display:inline-block;width:100%;padding-left:13px;background-color:#d4e8ff;box-shadow: 0 2px 4px 0 lightgray,0 2px 10px 0 #d4e8ff!important;")
                div(style="float:left;" id="reqUserDetails")
                  a(href="/profile/"+each.username id="linkProfile" style='font-weight:900;') #{each.name}

                div(style="float:right;display:inline-flex" id="choiceJoinBtn")  
                  div(style="cursor:pointer;margin-right:5px" id="choiceAcceptBtn")
                    i(class="mega-octicon octicon-issue-opened" )
                      span  Accept

                  div(style="cursor:pointer;margin-right:5px" id="choiceDeclineBtn")
                    i(class="mega-octicon octicon-issue-closed")
                      span  Decline
                  
      else
        div(style="text-align:center!important;padding-top:100px")
            img(src="/images/SuccessLogo.png" style="width:30%;opacity:0.7")
            br
            br
            h(style="font-weight:500; font-size:25pt; color:grey") Accept Pending requests
  script.
    $('#choiceAcceptBtn').click(function(e){
        e.preventDefault();
        console.log();

        var reqUserUsername = $(this).parents('.issuePart1D').find('div#reqUserDetails').find('a#linkProfile').attr('href').substring(9);
        console.log(reqUserUsername);
        var reqUserName = $(this).parents('.issuePart1D').find('div#reqUserDetails').find('a#linkProfile').text();
        console.log(reqUserName);


        $(this).parents('#choiceJoinBtn').html($('<div style="background-color:#42b72ab8;padding:5px;color:white;border-radius:3px;"><i class="ionicons ion-android-done-all"></i><span> Accepted</span></div>'));
        
        var data = {};
        data.orgDtl = "#{orgDtl.userId}";
        data.reqUserUsername = reqUserUsername;
        data.reqUserName = reqUserName;
        console.log(data);

      $.ajax({
        type: 'POST',
        data: JSON.stringify(data),
        url: '/acceptReq/',
        contentType: 'application/json',            
        success: function(data) {
            console.log('success');
        }
      })
    });

    $('#choiceDeclineBtn').click(function(e){
      e.preventDefault();
     
      var reqUserUsername = $(this).parents('.issuePart1D').find('div#reqUserDetails').find('a#linkProfile').attr('href').substring(9);

      var reqUserName = $(this).parents('.issuePart1D').find('div#reqUserDetails').find('a#linkProfile').text();

     
      $(this).parents('#choiceJoinBtn').html($('<div style="background-color:#ff0000b8;padding:5px;color:white;border-radius:3px;"><i class="ionicons ion-ios-trash-outline"></i><span> Declined</span></div>'));
        
      var data = {};
      data.orgDtl = "#{orgDtl.userId}";
      data.reqUserUsername = reqUserUsername;
      data.reqUserName = reqUserName;
      console.log(data);

      $.ajax({
        type: 'POST',
        data: JSON.stringify(data),
        url: '/declineReq/',
        contentType: 'application/json',            
        success: function(data) {
            console.log('success');
        }
      })
    });